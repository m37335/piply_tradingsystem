# Exchange Analytics - å®Ÿç”¨çš„ãªCrontabè¨­å®šä¾‹
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ crontab -e ã§è¨­å®š

# ç’°å¢ƒå¤‰æ•°è¨­å®š
SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin
HOME=/app

# Exchange Analytics ç’°å¢ƒå¤‰æ•°
# ï¼ˆå®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
ALPHA_VANTAGE_API_KEY=demo
OPENAI_API_KEY=your_openai_key_here
DISCORD_WEBHOOK_URL=your_discord_webhook_here

# ðŸ§ª ãƒ†ã‚¹ãƒˆç”¨ï¼ˆ2åˆ†é–“éš”ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆï¼‰
*/2 * * * * cd /app && echo "$(date): Cron test" >> /app/logs/cron_test.log 2>&1

# ðŸ“Š ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ15åˆ†é–“éš”ã€å¹³æ—¥9-17æ™‚ï¼‰
*/15 9-17 * * 1-5 cd /app && timeout 300 python data_scheduler.py --test >> /app/logs/data_cron.log 2>&1

# ðŸ¤– AIåˆ†æžï¼ˆ1æ™‚é–“é–“éš”ã€å¹³æ—¥ã®ã¿ï¼‰
0 */1 9-17 * * 1-5 cd /app && timeout 120 python real_ai_discord.py USD/JPY >> /app/logs/ai_cron.log 2>&1

# ðŸ“ˆ æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ¯Žæ—¥18:00ï¼‰
0 18 * * * cd /app && timeout 60 python -c "
import asyncio
import sys
sys.path.append('/app')
from data_scheduler import DataScheduler
scheduler = DataScheduler()
asyncio.run(scheduler._send_daily_report())
" >> /app/logs/daily_cron.log 2>&1

# ðŸ” ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ï¼ˆ30åˆ†é–“éš”ï¼‰
*/30 * * * * cd /app && timeout 30 python realtime_monitor.py --interval 1 --no-alerts >> /app/logs/monitor_cron.log 2>&1

# ðŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ¯Žæ—¥2:00ï¼‰
0 2 * * * cd /app/logs && find . -name "*.log" -size +10M -exec gzip {} \; && find . -name "*.gz" -mtime +7 -delete

# ðŸ’š APIç¨¼åƒç¢ºèªï¼ˆ10åˆ†é–“éš”ï¼‰
*/10 * * * * timeout 5 curl -s http://localhost:8000/health > /dev/null || echo "$(date): API down" >> /app/logs/api_alert.log

# ðŸ“Š é€±æ¬¡çµ±è¨ˆï¼ˆæ¯Žé€±æœˆæ›œæ—¥9:00ï¼‰
0 9 * * 1 cd /app && python -c "
import subprocess
import json
from datetime import datetime
print(f'Weekly stats: {datetime.now()}')
try:
    result = subprocess.run(['python', 'test_alphavantage.py', '--test', 'connection'],
                          capture_output=True, text=True, cwd='/app')
    print(f'Alpha Vantage test: {result.returncode == 0}')
except Exception as e:
    print(f'Weekly stats error: {e}')
" >> /app/logs/weekly.log 2>&1
