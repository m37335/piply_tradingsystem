# ğŸ“Š åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„è¨­è¨ˆæ›¸

**æ—§ãƒ•ã‚¡ã‚¤ãƒ«å**: `basic_data_acquisition_improvement_design_2025.md`  
**ä½œæˆæ—¥**: 2025 å¹´ 1 æœˆ
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Exchange Analytics System
**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **: åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºçµ±åˆã‚·ã‚¹ãƒ†ãƒ 
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0

## ğŸ¯ è¨­è¨ˆç›®çš„

### å•é¡Œè§£æ±º

- **äººå·¥ãƒ‡ãƒ¼ã‚¿å•é¡Œ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒäººå·¥çš„ã§å®Ÿéš›ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã§ã¯ãªã„
- **ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã‚¹ã‚­ãƒƒãƒ—**: crontab ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¸æ•´åˆ**: åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ç¶™ç¶šãƒ‡ãƒ¼ã‚¿å–å¾—ã®å‡¦ç†ãŒç•°ãªã‚‹
- **ã‚·ã‚¹ãƒ†ãƒ çµ±åˆä¸è¶³**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç‹¬ç«‹ã—ã¦å‹•ä½œã—ã€çµ±åˆã•ã‚Œã¦ã„ãªã„

### ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

**ç›®æ¨™**: å®Ÿéš›ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‚’è¨ˆç®—ã—ã¦ã€ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã‚’è¡Œã†çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰

## ğŸ—ï¸ ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Crontab       â”‚â”€â”€â”€â–ºâ”‚   USD/JPY Data  â”‚â”€â”€â”€â–ºâ”‚   DataFetcher   â”‚
â”‚   (5åˆ†é–“éš”)      â”‚    â”‚   Cron          â”‚    â”‚   Service       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Pattern       â”‚    â”‚   Yahoo Finance â”‚
                       â”‚   Detection     â”‚    â”‚   Client        â”‚
                       â”‚   Service       â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Notification  â”‚    â”‚   _normalize_   â”‚
                       â”‚   Service       â”‚    â”‚   ticker_data   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚   Database      â”‚
                                              â”‚   (äººå·¥ãƒ‡ãƒ¼ã‚¿)   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. Crontab è¨­å®š

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `current_crontab.txt`
- **å®Ÿè¡Œé–“éš”**: 5 åˆ†é–“éš”ï¼ˆå¹³æ—¥ 24 æ™‚é–“ï¼‰
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/cron/usdjpy_data_cron.py`

#### 2. ãƒ¡ã‚¤ãƒ³ cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/cron/usdjpy_data_cron.py`
- **ã‚¯ãƒ©ã‚¹**: `USDJPYDataCron`
- **è²¬ä»»**: ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã€é€šçŸ¥å‡¦ç†

#### 3. ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚µãƒ¼ãƒ“ã‚¹

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/infrastructure/database/services/data_fetcher_service.py`
- **ã‚¯ãƒ©ã‚¹**: `DataFetcherService`
- **è²¬ä»»**: Yahoo Finance ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–

#### 4. Yahoo Finance ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/infrastructure/external_apis/yahoo_finance_client.py`
- **ã‚¯ãƒ©ã‚¹**: `YahooFinanceClient`
- **è²¬ä»»**: Yahoo Finance API ã¨ã®é€šä¿¡

#### 5. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‚µãƒ¼ãƒ“ã‚¹

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/infrastructure/database/services/technical_indicator_service.py`
- **ã‚¯ãƒ©ã‚¹**: `TechnicalIndicatorService`
- **è²¬ä»»**: RSIã€MACDã€ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ã®è¨ˆç®—

#### 6. ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã‚µãƒ¼ãƒ“ã‚¹

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/infrastructure/database/services/pattern_detection_service.py`
- **ã‚¯ãƒ©ã‚¹**: `PatternDetectionService`
- **è²¬ä»»**: 6 ç¨®é¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º

## ğŸš¨ å•é¡Œç‚¹ã®è©³ç´°åˆ†æ

### 1. äººå·¥ãƒ‡ãƒ¼ã‚¿å•é¡Œ

#### å•é¡Œã®ç‰¹å®š

```python
# src/infrastructure/database/services/data_fetcher_service.py: _normalize_ticker_data
def _normalize_ticker_data(self, ticker_data: Dict) -> Optional[PriceDataModel]:
    if "rate" in ticker_data:
        close_price = ticker_data.get("rate", 0)
        high_price = ticker_data.get("day_high", close_price)  # å•é¡Œ: æ—¥æ¬¡Highã‚’5åˆ†è¶³ã«ä½¿ç”¨
        low_price = ticker_data.get("day_low", close_price)    # å•é¡Œ: æ—¥æ¬¡Lowã‚’5åˆ†è¶³ã«ä½¿ç”¨
        open_price = ticker_data.get("previous_close", close_price)  # å•é¡Œ: å‰æ—¥çµ‚å€¤ã‚’5åˆ†è¶³Openã«ä½¿ç”¨
        volume = ticker_data.get("volume", 1000000)  # å•é¡Œ: å›ºå®šVolume
```

#### æ ¹æœ¬åŸå› 

- **Yahoo Finance API**: `get_current_rate()`ã¯æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ï¼ˆday_high, day_low, previous_closeï¼‰ã‚’è¿”ã™
- **ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–**: æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ 5 åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜ã—ã¦ã„ã‚‹
- **Volume**: å›ºå®šå€¤ï¼ˆ1,000,000ï¼‰ã‚’ä½¿ç”¨

#### å½±éŸ¿

- ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã®ä¿¡é ¼æ€§ä½ä¸‹
- ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã®ä¸æ­£ç¢ºæ€§
- ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ä¿¡é ¼æ€§å•é¡Œ

### 2. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã‚¹ã‚­ãƒƒãƒ—å•é¡Œ

#### å•é¡Œã®ç‰¹å®š

```python
# scripts/cron/usdjpy_data_cron.py: 164-168è¡Œç›®
# 2. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
logger.info("Step 2: Calculating technical indicators...")
# ç¾åœ¨ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ—¢ã«è¨ˆç®—æ¸ˆã¿ã®ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãŒã‚ã‚‹ãŸã‚ã€
# ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã«å¿…è¦ãªæœ€å°é™ã®å‡¦ç†ã®ã¿å®Ÿè¡Œ
logger.info("Technical indicators already calculated in database")
```

#### æ ¹æœ¬åŸå› 

- **ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ**: ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã„ã‚‹
- **èª¤è§£**: "æ—¢ã«è¨ˆç®—æ¸ˆã¿"ã¨ã„ã†èª¤ã£ãŸå‰æ
- **å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `technical_indicators_calculator.py`ãŒå­˜åœ¨ã™ã‚‹ãŒ crontab ã§å‘¼ã³å‡ºã•ã‚Œã¦ã„ãªã„

#### å½±éŸ¿

- ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãŒæ›´æ–°ã•ã‚Œãªã„
- ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãŒæ­£å¸¸ã«å‹•ä½œã—ãªã„
- ã‚·ã‚¹ãƒ†ãƒ ã®æ©Ÿèƒ½ä¸å…¨

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¸æ•´åˆå•é¡Œ

#### åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾— vs ç¶™ç¶šãƒ‡ãƒ¼ã‚¿å–å¾—

```python
# åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆscripts/cron/unified_initialization.pyï¼‰
df = await self.yahoo_client.get_historical_data(
    self.currency_pair, period, interval
)
# å®Ÿéš›ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨

# ç¶™ç¶šãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆscripts/cron/usdjpy_data_cron.pyï¼‰
ticker_data = await self.yahoo_client.get_current_rate(self.currency_pair)
# æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦äººå·¥ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
```

#### æ ¹æœ¬åŸå› 

- **ç•°ãªã‚‹ API**: åˆå›ã¯`get_historical_data()`ã€ç¶™ç¶šã¯`get_current_rate()`
- **ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼**: åˆå›ã¯å®Ÿéš›ã® OHLCVã€ç¶™ç¶šã¯äººå·¥ãƒ‡ãƒ¼ã‚¿
- **å‡¦ç†ã®ä¸çµ±ä¸€**: åŒã˜ã‚·ã‚¹ãƒ†ãƒ ã§ç•°ãªã‚‹å‡¦ç†æ–¹æ³•

### 4. ã‚·ã‚¹ãƒ†ãƒ çµ±åˆä¸è¶³å•é¡Œ

#### åˆ†æ•£ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—**: `InitialDataLoaderService`
- **ç¶™ç¶šãƒ‡ãƒ¼ã‚¿å–å¾—**: `DataFetcherService`
- **ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—**: `TechnicalIndicatorService`
- **ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º**: `PatternDetectionService`
- **é€šçŸ¥å‡¦ç†**: `NotificationIntegrationService`

#### æ ¹æœ¬åŸå› 

- **ç‹¬ç«‹ã—ãŸå®Ÿè¡Œ**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç‹¬ç«‹ã—ã¦å‹•ä½œ
- **çµ±åˆãƒ•ãƒ­ãƒ¼ä¸è¶³**: ä¸€é€£ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ãŒç¢ºç«‹ã•ã‚Œã¦ã„ãªã„
- **ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ãªã„

## ğŸ”§ ä¿®æ­£æ¡ˆ

### 1. ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¿®æ­£

#### å³åº§ã®ä¿®æ­£æ¡ˆ

```python
# src/infrastructure/database/services/data_fetcher_service.py
async def fetch_real_5m_data(self) -> Optional[PriceDataModel]:
    """å®Ÿéš›ã®5åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—"""
    try:
        # Yahoo Financeã‹ã‚‰5åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        df = await self.yahoo_client.get_historical_data(
            "USD/JPY", "1d", "5m"  # 1æ—¥åˆ†ã®5åˆ†è¶³ãƒ‡ãƒ¼ã‚¿
        )

        if df is None or df.empty:
            return None

        # æœ€æ–°ã®5åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
        latest_row = df.iloc[-1]

        # å®Ÿéš›ã®OHLCVãƒ‡ãƒ¼ã‚¿ã§PriceDataModelä½œæˆ
        price_data = PriceDataModel(
            currency_pair="USD/JPY",
            timestamp=datetime.now(),
            open_price=float(latest_row["Open"]),
            high_price=float(latest_row["High"]),
            low_price=float(latest_row["Low"]),
            close_price=float(latest_row["Close"]),
            volume=int(latest_row["Volume"]) if latest_row["Volume"] > 0 else 1000000,
            data_source="Yahoo Finance 5m Real"
        )

        return price_data

    except Exception as e:
        logger.error(f"5åˆ†è¶³ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: {e}")
        return None
```

#### crontab ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£

```python
# scripts/cron/usdjpy_data_cron.py
async def run_single_execution(self):
    # 1. ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆä¿®æ­£ç‰ˆï¼‰
    logger.info("Step 1: Fetching current price data...")
    data_fetcher = self.services["data_fetcher"]

    # å®Ÿéš›ã®5åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    price_data = await data_fetcher.fetch_real_5m_data()

    if not price_data:
        raise Exception("No price data fetched")

    logger.info(f"Fetched price data: {price_data}")

    # 2. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ï¼ˆå®Ÿéš›ã«è¨ˆç®—ï¼‰
    logger.info("Step 2: Calculating technical indicators...")
    technical_analyzer = self.services["technical_analyzer"]

    # æœ€æ–°ã®ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦æŒ‡æ¨™è¨ˆç®—
    latest_data = await self.price_repo.find_latest_data(limit=100)
    if latest_data:
        df = self._convert_to_dataframe(latest_data)

        # RSIè¨ˆç®—
        rsi_result = technical_analyzer.calculate_rsi(df, "5m")

        # MACDè¨ˆç®—
        macd_result = technical_analyzer.calculate_macd(df, "5m")

        # ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰è¨ˆç®—
        bb_result = technical_analyzer.calculate_bollinger_bands(df, "5m")

        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
        await self._save_technical_indicators(rsi_result, macd_result, bb_result)

        logger.info(f"Calculated and saved technical indicators")
```

### 2. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã®æœ‰åŠ¹åŒ–

#### å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã® crontab è¿½åŠ 

```bash
# current_crontab.txt ã«è¿½åŠ 
# ğŸ“ˆ ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ï¼ˆ10åˆ†é–“éš”ã€å¹³æ—¥24æ™‚é–“ç¨¼åƒï¼‰
*/10 * * * 1-5 cd /app && export $(cat .env | grep -v '^#' | xargs) && timeout 120 python scripts/cron/technical_indicators_calculator.py >> /app/logs/technical_indicators_cron.log 2>&1
```

#### çµ±åˆ AI åˆ†æã§ã®ä¿å­˜æ©Ÿèƒ½è¿½åŠ 

```python
# scripts/cron/integrated_ai_discord.py
async def _fetch_technical_indicators(self, currency_pair: str):
    # æ—¢å­˜ã®è¨ˆç®—å‡¦ç†...

    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    await self._save_indicators_to_database(indicators_data)
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®çµ±ä¸€

#### çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚µãƒ¼ãƒ“ã‚¹

```python
# src/infrastructure/database/services/unified_data_service.py
class UnifiedDataService:
    """çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚µãƒ¼ãƒ“ã‚¹"""

    async def fetch_and_process_data(self, timeframe: str = "5m") -> Dict[str, Any]:
        """ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨å‡¦ç†ã‚’çµ±åˆå®Ÿè¡Œ"""
        try:
            # 1. å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            if timeframe == "5m":
                price_data = await self.fetch_real_5m_data()
            else:
                price_data = await self.fetch_historical_data(timeframe)

            # 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
            saved_data = await self.save_price_data(price_data)

            # 3. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‚’è¨ˆç®—
            indicators = await self.calculate_technical_indicators(timeframe)

            # 4. ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º
            patterns = await self.detect_patterns(timeframe)

            return {
                "price_data": saved_data,
                "indicators": indicators,
                "patterns": patterns
            }

        except Exception as e:
            logger.error(f"çµ±åˆãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ©ãƒ¼: {e}")
            raise
```

### 4. ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã®æ”¹å–„

#### çµ±åˆ cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```python
# scripts/cron/unified_data_cron.py
class UnifiedDataCron:
    """çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾—cronã‚¹ã‚¯ãƒªãƒ—ãƒˆ"""

    async def run_single_execution(self):
        """çµ±åˆå®Ÿè¡Œ"""
        try:
            # 1. ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨å‡¦ç†
            result = await self.unified_data_service.fetch_and_process_data()

            # 2. é€šçŸ¥å‡¦ç†
            if result["patterns"]:
                await self.notification_service.send_notifications(result["patterns"])

            # 3. ç›£è¦–ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²
            await self.monitor.record_execution(result)

            return result

        except Exception as e:
            logger.error(f"çµ±åˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: {e}")
            raise
```

## ğŸ“‹ å®Ÿè£…è¨ˆç”»

### Phase 1: å³åº§ã®ä¿®æ­£ï¼ˆ1-2 æ—¥ï¼‰

#### 1.1 ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¿®æ­£

- [ ] `DataFetcherService.fetch_real_5m_data()` ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…
- [ ] `usdjpy_data_cron.py` ã®ä¿®æ­£
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨å‹•ä½œç¢ºèª

#### 1.2 ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã®æœ‰åŠ¹åŒ–

- [ ] `usdjpy_data_cron.py` ã§ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã‚’æœ‰åŠ¹åŒ–
- [ ] `technical_indicators_calculator.py` ã‚’ crontab ã«è¿½åŠ 
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨å‹•ä½œç¢ºèª

### Phase 2: ã‚·ã‚¹ãƒ†ãƒ çµ±åˆï¼ˆ3-5 æ—¥ï¼‰

#### 2.1 çµ±åˆãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…

- [ ] `UnifiedDataService` ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®çµ±ä¸€
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„

#### 2.2 çµ±åˆ cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè£…

- [ ] `UnifiedDataCron` ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
- [ ] crontab è¨­å®šã®æ›´æ–°
- [ ] ç›£è¦–æ©Ÿèƒ½ã®çµ±åˆ

### Phase 3: æœ€é©åŒ–ã¨ç›£è¦–ï¼ˆ1-2 æ—¥ï¼‰

#### 3.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–
- [ ] å‡¦ç†æ™‚é–“ã®çŸ­ç¸®

#### 3.2 ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ

- [ ] ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ç›£è¦–ã®å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®è¿½åŠ 

## ğŸ” é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«

#### Crontab é–¢é€£

- `current_crontab.txt` - ç¾åœ¨ã® crontab è¨­å®š
- `scripts/cron/usdjpy_data_cron.py` - ãƒ¡ã‚¤ãƒ³ cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/cron/technical_indicators_calculator.py` - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/cron/integrated_ai_discord.py` - çµ±åˆ AI åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### ãƒ‡ãƒ¼ã‚¿å–å¾—é–¢é€£

- `src/infrastructure/database/services/data_fetcher_service.py` - ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚µãƒ¼ãƒ“ã‚¹
- `src/infrastructure/external_apis/yahoo_finance_client.py` - Yahoo Finance ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `src/infrastructure/database/services/multi_timeframe_data_fetcher_service.py` - ãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—

#### ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™é–¢é€£

- `src/infrastructure/database/services/technical_indicator_service.py` - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‚µãƒ¼ãƒ“ã‚¹
- `src/infrastructure/database/services/multi_timeframe_technical_indicator_service.py` - ãƒãƒ«ãƒã‚¿ã‚¤ãƒ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™
- `src/infrastructure/analysis/technical_indicators.py` - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™åˆ†æ

#### ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºé–¢é€£

- `src/infrastructure/database/services/pattern_detection_service.py` - ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã‚µãƒ¼ãƒ“ã‚¹
- `src/infrastructure/database/services/efficient_pattern_detection_service.py` - åŠ¹ç‡çš„ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º

#### åˆæœŸåŒ–é–¢é€£

- `scripts/cron/unified_initialization.py` - çµ±åˆåˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `src/infrastructure/database/services/initial_data_loader_service.py` - åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚µãƒ¼ãƒ“ã‚¹
- `src/infrastructure/database/services/system_initialization_manager.py` - ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

#### ç¶™ç¶šå‡¦ç†é–¢é€£

- `scripts/cron/continuous_processing_cron.py` - ç¶™ç¶šå‡¦ç† cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `src/infrastructure/database/services/continuous_processing_service.py` - ç¶™ç¶šå‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹
- `src/infrastructure/schedulers/continuous_processing_scheduler.py` - ç¶™ç¶šå‡¦ç†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£

#### ãƒ¢ãƒ‡ãƒ«

- `src/infrastructure/database/models/price_data_model.py` - ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- `src/infrastructure/database/models/technical_indicator_model.py` - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãƒ¢ãƒ‡ãƒ«
- `src/infrastructure/database/models/pattern_detection_model.py` - ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ¢ãƒ‡ãƒ«

#### ãƒªãƒã‚¸ãƒˆãƒª

- `src/infrastructure/database/repositories/price_data_repository_impl.py` - ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ãƒªãƒã‚¸ãƒˆãƒª
- `src/infrastructure/database/repositories/technical_indicator_repository_impl.py` - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãƒªãƒã‚¸ãƒˆãƒª
- `src/infrastructure/database/repositories/pattern_detection_repository_impl.py` - ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒªãƒã‚¸ãƒˆãƒª

### è¨­å®šãƒ»ãƒ­ã‚°é–¢é€£

#### è¨­å®š

- `.env` - ç’°å¢ƒå¤‰æ•°è¨­å®š
- `src/utils/logging_config.py` - ãƒ­ã‚°è¨­å®š

#### ãƒ­ã‚°

- `/app/logs/data_cron.log` - ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚°
- `/app/logs/technical_indicators_cron.log` - ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ãƒ­ã‚°
- `/app/logs/integrated_ai_cron.log` - çµ±åˆ AI åˆ†æãƒ­ã‚°

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. ãƒ‡ãƒ¼ã‚¿å“è³ªã®å‘ä¸Š

- **å®Ÿéš›ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿**: äººå·¥ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å®Ÿéš›ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã¸ã®ç§»è¡Œ
- **æ­£ç¢ºãªãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™**: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæ­£ç¢ºãªæŒ‡æ¨™è¨ˆç®—
- **ä¿¡é ¼æ€§ã®å‘ä¸Š**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ä¿¡é ¼æ€§å‘ä¸Š

### 2. ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã®å®Œå…¨åŒ–

- **ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—**: ç¶™ç¶šçš„ãªæŒ‡æ¨™è¨ˆç®—ã®å®Ÿç¾
- **ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º**: æ­£ç¢ºãªãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ããƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
- **é€šçŸ¥æ©Ÿèƒ½**: é‡è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã®é©åˆ‡ãªé€šçŸ¥

### 3. é‹ç”¨åŠ¹ç‡ã®å‘ä¸Š

- **çµ±åˆãƒ•ãƒ­ãƒ¼**: ä¸€é€£ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®ç¢ºç«‹
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ç›£è¦–æ©Ÿèƒ½**: ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ã®ç›£è¦–

### 4. ä¿å®ˆæ€§ã®å‘ä¸Š

- **ã‚³ãƒ¼ãƒ‰çµ±åˆ**: åˆ†æ•£ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆ
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ˜ç¢ºåŒ–**: å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ˜ç¢ºåŒ–
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: çµ±åˆã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å³åº§ã«å®Ÿè¡Œã™ã¹ãé …ç›®

1. **ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¿®æ­£**: `fetch_real_5m_data()` ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…
2. **crontab ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£**: ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™è¨ˆç®—ã®æœ‰åŠ¹åŒ–
3. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: ä¿®æ­£å¾Œã®å‹•ä½œç¢ºèª

### ä¸­æœŸçš„ãªæ”¹å–„é …ç›®

1. **ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ**: çµ±åˆãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…
2. **ç›£è¦–æ©Ÿèƒ½**: ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ç›£è¦–ã®å®Ÿè£…
3. **æœ€é©åŒ–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### é•·æœŸçš„ãªæ”¹å–„é …ç›®

1. **æ‹¡å¼µæ€§**: ä»–ã®é€šè²¨ãƒšã‚¢ã¸ã®å¯¾å¿œ
2. **é«˜åº¦ãªåˆ†æ**: æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹åˆ†ææ©Ÿèƒ½ã®è¿½åŠ 
3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†**: ã‚ˆã‚Šé«˜é€Ÿãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã®å®Ÿç¾

---

**ä½œæˆè€…**: AI Assistant
**æœ€çµ‚æ›´æ–°**: 2025 å¹´ 1 æœˆ
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆå®Œäº†ã€å®Ÿè£…æº–å‚™ä¸­
