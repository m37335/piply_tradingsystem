**æ—§ãƒ•ã‚¡ã‚¤ãƒ«å**: `api_optimization_design_2025.md`  

# ğŸ”§ API æœ€é©åŒ–è¨­è¨ˆæ›¸ï¼ˆ2025 å¹´ 8 æœˆç‰ˆï¼‰

# API åˆ¶é™å•é¡Œè§£æ±ºã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ´»ç”¨æˆ¦ç•¥

## ğŸ“‹ æ¦‚è¦

### å•é¡Œã®èƒŒæ™¯

- **API åˆ¶é™ã‚¨ãƒ©ãƒ¼**: Yahoo Finance API ã®éåº¦ãªå‘¼ã³å‡ºã—ã«ã‚ˆã‚‹åˆ¶é™ã‚¨ãƒ©ãƒ¼
- **å®Ÿè¡Œé »åº¦**: ç¾åœ¨ 2 æ™‚é–“ã”ã¨ã€1 æ™‚é–“ã”ã¨ã€ã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã«å®Ÿè¡Œ
- **1 å›ã®å®Ÿè¡Œ**: ç´„ 9 å›ã® API å‘¼ã³å‡ºã—ï¼ˆé€šè²¨ç›¸é–¢ 5 å› + ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ 3 å› + AI åˆ†æ 1 å›ï¼‰
- **1 æ—¥ã®ç·å‘¼ã³å‡ºã—**: ç´„ 171 å›/æ—¥

### è§£æ±ºç›®æ¨™

- **API å‘¼ã³å‡ºã—å‰Šæ¸›**: 80%ä»¥ä¸Šã®å‰Šæ¸›ã‚’ç›®æŒ‡ã™
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ´»ç”¨**: æ—¢å­˜ã® ExchangeRateModel ã‚’æœ€å¤§é™æ´»ç”¨
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: ãƒ¡ãƒ¢ãƒªãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® 3 å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **é€šçŸ¥ç²¾åº¦ç¶­æŒ**: ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦ã‚’ä¿ã¡ãªãŒã‚‰ API å‰Šæ¸›

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cron Jobs     â”‚â”€â”€â”€â–¶â”‚  API Clients    â”‚â”€â”€â”€â–¶â”‚  External APIs  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ integrated_ai â”‚    â”‚ â€¢ YahooFinance  â”‚    â”‚ â€¢ Yahoo Finance â”‚
â”‚ â€¢ real_ai_v2    â”‚    â”‚ â€¢ OpenAI        â”‚    â”‚ â€¢ OpenAI        â”‚
â”‚ â€¢ data_schedulerâ”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Analysis      â”‚
                       â”‚                 â”‚
                       â”‚ â€¢ Technical     â”‚
                       â”‚ â€¢ Correlation   â”‚
                       â”‚ â€¢ AI Analysis   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ€é©åŒ–å¾Œã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cron Jobs     â”‚â”€â”€â”€â–¶â”‚  Cache Layer    â”‚â”€â”€â”€â–¶â”‚  Database       â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ integrated_ai â”‚    â”‚ â€¢ Memory Cache  â”‚    â”‚ â€¢ ExchangeRate  â”‚
â”‚ â€¢ real_ai_v2    â”‚    â”‚ â€¢ File Cache    â”‚    â”‚ â€¢ AnalysisCache â”‚
â”‚ â€¢ data_schedulerâ”‚    â”‚ â€¢ DB Cache      â”‚    â”‚ â€¢ Notification  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  API Clients    â”‚â”€â”€â”€â–¶â”‚  External APIs  â”‚
                       â”‚                 â”‚    â”‚                 â”‚
                       â”‚ â€¢ YahooFinance  â”‚    â”‚ â€¢ Yahoo Finance â”‚
                       â”‚ â€¢ OpenAI        â”‚    â”‚ â€¢ OpenAI        â”‚
                       â”‚ â€¢ Rate Limited  â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
1. Cronå®Ÿè¡Œ
   â†“
2. fetch_all_currency_data()
   â”œâ”€â”€ USD/JPY APIå‘¼ã³å‡ºã—
   â”œâ”€â”€ EUR/USD APIå‘¼ã³å‡ºã—
   â”œâ”€â”€ GBP/USD APIå‘¼ã³å‡ºã—
   â”œâ”€â”€ EUR/JPY APIå‘¼ã³å‡ºã—
   â””â”€â”€ GBP/JPY APIå‘¼ã³å‡ºã—
   â†“
3. _fetch_technical_indicators()
   â”œâ”€â”€ D1å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—
   â”œâ”€â”€ H4å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—
   â””â”€â”€ H1å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—
   â†“
4. generate_integrated_analysis()
   â””â”€â”€ OpenAI APIå‘¼ã³å‡ºã—
```

### æœ€é©åŒ–å¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
1. Cronå®Ÿè¡Œ
   â†“
2. CacheManager.check_data_freshness()
   â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—
   â”œâ”€â”€ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
   â””â”€â”€ å¿…è¦ã«å¿œã˜ã¦APIå‘¼ã³å‡ºã—
   â†“
3. DataOptimizer.get_optimized_data()
   â”œâ”€â”€ è¤‡æ•°é€šè²¨ãƒšã‚¢ã®ä¸€æ‹¬å–å¾—
   â”œâ”€â”€ å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„å–å¾—
   â””â”€â”€ åˆ†æçµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   â†“
4. AnalysisCache.get_cached_analysis()
   â””â”€â”€ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸåˆ†æçµæœã®æ´»ç”¨
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ‹¡å¼µ

### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ´»ç”¨

```sql
-- æ—¢å­˜ã®exchange_ratesãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE exchange_rates (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) UNIQUE NOT NULL,
    currency_pair VARCHAR(10) NOT NULL,
    rate NUMERIC(20,10) NOT NULL,
    bid_rate NUMERIC(20,10),
    ask_rate NUMERIC(20,10),
    spread NUMERIC(20,10),
    high_rate NUMERIC(20,10),
    low_rate NUMERIC(20,10),
    open_rate NUMERIC(20,10),
    close_rate NUMERIC(20,10),
    volume INTEGER,
    source VARCHAR(50) NOT NULL DEFAULT 'unknown',
    timestamp TIMESTAMP WITH TIME ZONE NOT NULL,
    extra_metadata TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    version INTEGER DEFAULT 1
);
```

### æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 

```sql
-- åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE analysis_cache (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) UNIQUE NOT NULL,
    analysis_type VARCHAR(50) NOT NULL,
    currency_pair VARCHAR(10) NOT NULL,
    timeframe VARCHAR(10),
    analysis_data JSONB NOT NULL,
    cache_key VARCHAR(255) UNIQUE NOT NULL,
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    version INTEGER DEFAULT 1
);

-- é€šçŸ¥å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE notification_history (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) UNIQUE NOT NULL,
    pattern_type VARCHAR(50) NOT NULL,
    currency_pair VARCHAR(10) NOT NULL,
    notification_data JSONB NOT NULL,
    sent_at TIMESTAMP WITH TIME ZONE NOT NULL,
    discord_message_id VARCHAR(50),
    status VARCHAR(20) DEFAULT 'sent',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    version INTEGER DEFAULT 1
);

-- APIå‘¼ã³å‡ºã—å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE api_call_history (
    id SERIAL PRIMARY KEY,
    uuid VARCHAR(36) UNIQUE NOT NULL,
    api_name VARCHAR(50) NOT NULL,
    endpoint VARCHAR(100) NOT NULL,
    currency_pair VARCHAR(10),
    response_time_ms INTEGER,
    status_code INTEGER,
    success BOOLEAN NOT NULL,
    error_message TEXT,
    called_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    version INTEGER DEFAULT 1
);
```

## ğŸ”§ å®Ÿè£…ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 1. CacheManager

```python
# src/infrastructure/cache/cache_manager.py
class CacheManager:
    """3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self):
        self.memory_cache = {}  # ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
        self.file_cache_path = "/app/cache"
        self.db_session = None  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³

    async def get_cached_data(self, cache_key: str, max_age_minutes: int = 5):
        """3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—"""
        pass

    async def set_cached_data(self, cache_key: str, data: Any, expires_in_minutes: int = 5):
        """3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ãƒ‡ãƒ¼ã‚¿ä¿å­˜"""
        pass

    async def check_data_freshness(self, currency_pair: str, timeframe: str):
        """ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦ãƒã‚§ãƒƒã‚¯"""
        pass
```

### 2. DataOptimizer

```python
# src/infrastructure/optimization/data_optimizer.py
class DataOptimizer:
    """ãƒ‡ãƒ¼ã‚¿å–å¾—æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, cache_manager: CacheManager):
        self.cache_manager = cache_manager
        self.yahoo_client = YahooFinanceClient()

    async def get_optimized_currency_data(self, currency_pairs: List[str]):
        """æœ€é©åŒ–ã•ã‚ŒãŸé€šè²¨ãƒ‡ãƒ¼ã‚¿å–å¾—"""
        pass

    async def get_optimized_historical_data(self, currency_pair: str, period: str, interval: str):
        """æœ€é©åŒ–ã•ã‚ŒãŸå±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—"""
        pass

    async def bulk_fetch_with_cache(self, requests: List[Dict]):
        """ä¸€æ‹¬å–å¾—ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥"""
        pass
```

### 3. AnalysisCache

```python
# src/infrastructure/cache/analysis_cache.py
class AnalysisCache:
    """åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ """

    def __init__(self, db_session):
        self.db_session = db_session

    async def get_cached_analysis(self, analysis_type: str, currency_pair: str, timeframe: str = None):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸåˆ†æçµæœå–å¾—"""
        pass

    async def cache_analysis_result(self, analysis_type: str, currency_pair: str,
                                  analysis_data: Dict, timeframe: str = None):
        """åˆ†æçµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥"""
        pass

    async def invalidate_analysis_cache(self, currency_pair: str):
        """åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç„¡åŠ¹åŒ–"""
        pass
```

### 4. NotificationManagerï¼ˆæ‹¡å¼µï¼‰

```python
# src/infrastructure/messaging/notification_manager.py
class NotificationManager:
    """é€šçŸ¥ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆé‡è¤‡é˜²æ­¢æ©Ÿèƒ½ä»˜ãï¼‰"""

    def __init__(self, discord_client: DiscordClient, db_session):
        self.discord_client = discord_client
        self.db_session = db_session

    async def send_pattern_notification(self, pattern_data: Dict):
        """ãƒ‘ã‚¿ãƒ¼ãƒ³é€šçŸ¥é€ä¿¡ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰"""
        pass

    async def check_duplicate_notification(self, pattern_type: str, currency_pair: str,
                                         time_window_minutes: int = 30):
        """é‡è¤‡é€šçŸ¥ãƒã‚§ãƒƒã‚¯"""
        pass

    async def log_notification(self, notification_data: Dict):
        """é€šçŸ¥å±¥æ­´è¨˜éŒ²"""
        pass
```

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆè¨­è¨ˆ

### æ–°è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ cache_manager.py          # 3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ analysis_cache.py         # åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”‚   â”‚   â””â”€â”€ file_cache.py             # ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”‚   â”œâ”€â”€ optimization/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ data_optimizer.py         # ãƒ‡ãƒ¼ã‚¿å–å¾—æœ€é©åŒ–
â”‚   â”‚   â”œâ”€â”€ api_rate_limiter.py       # APIåˆ¶é™ç®¡ç†
â”‚   â”‚   â””â”€â”€ batch_processor.py        # ãƒãƒƒãƒå‡¦ç†
â”‚   â””â”€â”€ database/
â”‚       â”œâ”€â”€ models/
â”‚       â”‚   â”œâ”€â”€ analysis_cache_model.py    # åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¢ãƒ‡ãƒ«
â”‚       â”‚   â”œâ”€â”€ notification_history_model.py  # é€šçŸ¥å±¥æ­´ãƒ¢ãƒ‡ãƒ«
â”‚       â”‚   â””â”€â”€ api_call_history_model.py  # APIå‘¼ã³å‡ºã—å±¥æ­´ãƒ¢ãƒ‡ãƒ«
â”‚       â””â”€â”€ repositories/
â”‚           â”œâ”€â”€ analysis_cache_repository_impl.py
â”‚           â”œâ”€â”€ notification_history_repository_impl.py
â”‚           â””â”€â”€ api_call_history_repository_impl.py
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ analysis_cache.py         # åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ notification_history.py   # é€šçŸ¥å±¥æ­´ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ api_call_history.py       # APIå‘¼ã³å‡ºã—å±¥æ­´ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â””â”€â”€ repositories/
â”‚       â”œâ”€â”€ analysis_cache_repository.py
â”‚       â”œâ”€â”€ notification_history_repository.py
â”‚       â””â”€â”€ api_call_history_repository.py
â””â”€â”€ utils/
    â”œâ”€â”€ cache_utils.py                # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â””â”€â”€ optimization_utils.py         # æœ€é©åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

### æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£

```
scripts/cron/
â”œâ”€â”€ integrated_ai_discord.py          # ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½çµ±åˆ
â”œâ”€â”€ real_ai_discord_v2.py             # ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½çµ±åˆ
â””â”€â”€ data_scheduler.py                 # æœ€é©åŒ–æ©Ÿèƒ½çµ±åˆ

src/infrastructure/
â”œâ”€â”€ external_apis/
â”‚   â””â”€â”€ yahoo_finance_client.py       # ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¼·åŒ–
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ technical_indicators.py       # ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾å¿œ
â”‚   â””â”€â”€ currency_correlation_analyzer.py  # æœ€é©åŒ–å¯¾å¿œ
â””â”€â”€ messaging/
    â””â”€â”€ discord_client.py             # é€šçŸ¥å±¥æ­´å¯¾å¿œ
```

## ğŸ”„ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ1 é€±é–“ï¼‰

1. **CacheManager å®Ÿè£…**

   - ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ**

   - AnalysisCacheModel
   - NotificationHistoryModel
   - ApiCallHistoryModel

3. **ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…**
   - å„ãƒ¢ãƒ‡ãƒ«ã«å¯¾å¿œã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒª

### Phase 2: ãƒ‡ãƒ¼ã‚¿æœ€é©åŒ–ï¼ˆ1 é€±é–“ï¼‰

1. **DataOptimizer å®Ÿè£…**

   - ä¸€æ‹¬ãƒ‡ãƒ¼ã‚¿å–å¾—
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆ
   - åŠ¹ç‡çš„ãªå±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—

2. **AnalysisCache å®Ÿè£…**

   - åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
   - æœ‰åŠ¹æœŸé™ç®¡ç†

3. **æ—¢å­˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¿®æ­£**
   - YahooFinanceClient æœ€é©åŒ–
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¼·åŒ–

### Phase 3: é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ï¼ˆ1 é€±é–“ï¼‰

1. **NotificationManager æ‹¡å¼µ**

   - é‡è¤‡é˜²æ­¢æ©Ÿèƒ½
   - é€šçŸ¥å±¥æ­´ç®¡ç†
   - ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºçµ±åˆ

2. **Cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ±åˆ**

   - integrated_ai_discord.py æœ€é©åŒ–
   - real_ai_discord_v2.py æœ€é©åŒ–
   - data_scheduler.py æœ€é©åŒ–

3. **ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼**
   - å˜ä½“ãƒ†ã‚¹ãƒˆ
   - çµ±åˆãƒ†ã‚¹ãƒˆ
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

## ğŸ“Š æœŸå¾…åŠ¹æœ

### API å‘¼ã³å‡ºã—å‰Šæ¸›

- **ç¾åœ¨**: 171 å›/æ—¥
- **æœ€é©åŒ–å¾Œ**: ç´„ 30 å›/æ—¥ï¼ˆ82%å‰Šæ¸›ï¼‰
- **å‰Šæ¸›è¦å› **:
  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥: 60%å‰Šæ¸›
  - åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥: 20%å‰Šæ¸›
  - ä¸€æ‹¬å–å¾—æœ€é©åŒ–: 10%å‰Šæ¸›

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: 50%çŸ­ç¸®
- **ã‚¨ãƒ©ãƒ¼ç‡**: 90%å‰Šæ¸›
- **ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§**: å¤§å¹…å‘ä¸Š

### ãƒ‡ãƒ¼ã‚¿å“è³ªç¶­æŒ

- **ãƒ‡ãƒ¼ã‚¿é®®åº¦**: 5 åˆ†ä»¥å†…ã‚’ä¿è¨¼
- **åˆ†æç²¾åº¦**: æ—¢å­˜ãƒ¬ãƒ™ãƒ«ç¶­æŒ
- **é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: æœ€é©åŒ–

## ğŸ› ï¸ æŠ€è¡“çš„è€ƒæ…®äº‹é …

### ä¾å­˜é–¢ä¿‚ç®¡ç†

```python
# requirements.txt è¿½åŠ 
redis==5.0.1              # ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
diskcache==5.6.3          # ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥
sqlalchemy[asyncio]==2.0.23  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæ—¢å­˜ï¼‰
alembic==1.12.1           # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ—¢å­˜ï¼‰
```

### è¨­å®šç®¡ç†

```python
# config/cache_settings.py
CACHE_CONFIG = {
    "memory_cache": {
        "max_size": 1000,
        "ttl_seconds": 300
    },
    "file_cache": {
        "path": "/app/cache",
        "max_size_mb": 100,
        "ttl_seconds": 1800
    },
    "database_cache": {
        "ttl_minutes": 60,
        "cleanup_interval_hours": 24
    }
}
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**
- **API åˆ¶é™æ™‚ã®æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•**
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å‡¦ç†**
- **éƒ¨åˆ†çš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—ã®å‡¦ç†**

### ç›£è¦–ãƒ»ãƒ­ã‚°

- **API å‘¼ã³å‡ºã—å›æ•°ã®ç›£è¦–**
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã®æ¸¬å®š**
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®è¿½è·¡**
- **ã‚¨ãƒ©ãƒ¼ç‡ã®ç›£è¦–**

## ğŸ“ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: åŸºç›¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ 

- [ ] CacheManager ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ä½œæˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ

### Phase 2: ãƒ‡ãƒ¼ã‚¿æœ€é©åŒ–

- [ ] DataOptimizer ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] AnalysisCache ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] YahooFinanceClient æœ€é©åŒ–
- [ ] æ—¢å­˜ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ä¿®æ­£
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆä½œæˆ

### Phase 3: é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–

- [ ] NotificationManager æ‹¡å¼µ
- [ ] Cron ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ±åˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] ç›£è¦–è¨­å®š

## ğŸ” ãƒªã‚¹ã‚¯ç®¡ç†

### æŠ€è¡“çš„ãƒªã‚¹ã‚¯

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¸æ•´åˆ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åŒæœŸå•é¡Œ
- **ãƒ¡ãƒ¢ãƒªä¸è¶³**: å¤§é‡ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªæ¶ˆè²»
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è² è·**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚ˆã‚‹è² è·å¢—åŠ 

### å¯¾ç­–

- **å®šæœŸçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–**
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–**
- **æ®µéšçš„ãªãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ**

## ğŸ“š å‚è€ƒè³‡æ–™

- [æ—¢å­˜è¨­è¨ˆæ›¸](./ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­è¨ˆ_20250809.md)
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](./è©³ç´°å†…éƒ¨è¨­è¨ˆ_20250809.md)
- [é€šçŸ¥ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…è¨ˆç”»](./notification_implementation_plan_2025.yaml)
- [Yahoo Finance API åˆ¶é™](https://finance.yahoo.com/quote/AAPL/history)
- [SQLAlchemy éåŒæœŸã‚µãƒãƒ¼ãƒˆ](https://docs.sqlalchemy.org/en/20/orm/extensions/asyncio.html)
