# æ—§ãƒ•ã‚¡ã‚¤ãƒ«å: api_optimization_implementation_plan_2025.yaml

# ğŸ”§ APIæœ€é©åŒ–å®Ÿè£…è¨ˆç”»ï¼ˆ2025å¹´8æœˆç‰ˆï¼‰
# YAMLå½¢å¼ã«ã‚ˆã‚‹æ§‹é€ åŒ–ã•ã‚ŒãŸå®Ÿè£…è¨ˆç”»

project:
  name: "API Optimization Implementation"
  version: "2025.8"
  description: "APIåˆ¶é™å•é¡Œè§£æ±ºã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ´»ç”¨ã«ã‚ˆã‚‹æœ€é©åŒ–å®Ÿè£…è¨ˆç”»"
  based_on: "api_optimization_design_2025.md"

# ğŸ“Š ç¾åœ¨ã®å•é¡Œåˆ†æ
current_issues:
  api_limitations:
    description: "APIåˆ¶é™ã‚¨ãƒ©ãƒ¼ã®è©³ç´°"
    daily_calls: 171
    call_breakdown:
      integrated_ai_discord: "9å›/å®Ÿè¡Œ Ã— 8å›/æ—¥ = 72å›"
      real_ai_discord_v2: "9å›/å®Ÿè¡Œ Ã— 8å›/æ—¥ = 72å›"
      market_opens: "9å›/å®Ÿè¡Œ Ã— 3å›/æ—¥ = 27å›"
    error_patterns:
      - "429 Too Many Requests"
      - "Rate limit exceeded"
      - "API quota exceeded"

  performance_issues:
    description: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ"
    response_time: "å¹³å‡3-5ç§’"
    error_rate: "ç´„15%"
    system_stability: "ä¸å®‰å®š"

# ğŸ¯ è§£æ±ºç›®æ¨™
optimization_goals:
  api_reduction:
    target: "80%ä»¥ä¸Šå‰Šæ¸›"
    current: 171
    target_calls: 30
    reduction_methods:
      database_cache: "60%å‰Šæ¸›"
      analysis_cache: "20%å‰Šæ¸›"
      batch_optimization: "10%å‰Šæ¸›"

  performance_improvement:
    response_time: "50%çŸ­ç¸®"
    error_rate: "90%å‰Šæ¸›"
    system_stability: "å¤§å¹…å‘ä¸Š"

# ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
file_structure:
  new_directories:
    - path: "src/infrastructure/cache/"
      description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ "
      files:
        - "__init__.py"
        - "cache_manager.py"
        - "analysis_cache.py"
        - "file_cache.py"

    - path: "src/infrastructure/optimization/"
      description: "æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ "
      files:
        - "__init__.py"
        - "data_optimizer.py"
        - "api_rate_limiter.py"
        - "batch_processor.py"

    - path: "src/infrastructure/database/models/"
      description: "æ–°è¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«"
      files:
        - "analysis_cache_model.py"
        - "notification_history_model.py"
        - "api_call_history_model.py"

    - path: "src/infrastructure/database/repositories/"
      description: "æ–°è¦ãƒªãƒã‚¸ãƒˆãƒª"
      files:
        - "analysis_cache_repository_impl.py"
        - "notification_history_repository_impl.py"
        - "api_call_history_repository_impl.py"

    - path: "src/domain/entities/"
      description: "æ–°è¦ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£"
      files:
        - "analysis_cache.py"
        - "notification_history.py"
        - "api_call_history.py"

    - path: "src/domain/repositories/"
      description: "æ–°è¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒª"
      files:
        - "analysis_cache_repository.py"
        - "notification_history_repository.py"
        - "api_call_history_repository.py"

    - path: "src/utils/"
      description: "æ–°è¦ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£"
      files:
        - "cache_utils.py"
        - "optimization_utils.py"

  modified_files:
    - path: "scripts/cron/integrated_ai_discord.py"
      description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½çµ±åˆ"
      changes:
        - "CacheManagerçµ±åˆ"
        - "DataOptimizerçµ±åˆ"
        - "AnalysisCacheçµ±åˆ"

    - path: "scripts/cron/real_ai_discord_v2.py"
      description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½çµ±åˆ"
      changes:
        - "CacheManagerçµ±åˆ"
        - "DataOptimizerçµ±åˆ"
        - "AnalysisCacheçµ±åˆ"

    - path: "scripts/cron/data_scheduler.py"
      description: "æœ€é©åŒ–æ©Ÿèƒ½çµ±åˆ"
      changes:
        - "DataOptimizerçµ±åˆ"
        - "ãƒãƒƒãƒå‡¦ç†æœ€é©åŒ–"

    - path: "src/infrastructure/external_apis/yahoo_finance_client.py"
      description: "ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¼·åŒ–"
      changes:
        - "æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å¼·åŒ–"
        - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆ"
        - "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„"

    - path: "src/infrastructure/analysis/technical_indicators.py"
      description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾å¿œ"
      changes:
        - "AnalysisCacheçµ±åˆ"
        - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯è¿½åŠ "

    - path: "src/infrastructure/analysis/currency_correlation_analyzer.py"
      description: "æœ€é©åŒ–å¯¾å¿œ"
      changes:
        - "DataOptimizerçµ±åˆ"
        - "ä¸€æ‹¬å–å¾—æœ€é©åŒ–"

    - path: "src/infrastructure/messaging/discord_client.py"
      description: "é€šçŸ¥å±¥æ­´å¯¾å¿œ"
      changes:
        - "é€šçŸ¥å±¥æ­´è¨˜éŒ²"
        - "é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½"

# ğŸ”„ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºè©³ç´°
implementation_phases:
  phase_1:
    name: "åŸºç›¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ "
    duration: "1é€±é–“"
    priority: "é«˜"
    dependencies: []

    tasks:
      database_models:
        - name: "AnalysisCacheModelä½œæˆ"
          file: "src/infrastructure/database/models/analysis_cache_model.py"
          description: "åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨ãƒ¢ãƒ‡ãƒ«"
          sql_schema: |
            CREATE TABLE analysis_cache (
                id SERIAL PRIMARY KEY,
                uuid VARCHAR(36) UNIQUE NOT NULL,
                analysis_type VARCHAR(50) NOT NULL,
                currency_pair VARCHAR(10) NOT NULL,
                timeframe VARCHAR(10),
                analysis_data JSONB NOT NULL,
                cache_key VARCHAR(255) UNIQUE NOT NULL,
                expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
                created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                version INTEGER DEFAULT 1
            );

        - name: "NotificationHistoryModelä½œæˆ"
          file: "src/infrastructure/database/models/notification_history_model.py"
          description: "é€šçŸ¥å±¥æ­´ç”¨ãƒ¢ãƒ‡ãƒ«"
          sql_schema: |
            CREATE TABLE notification_history (
                id SERIAL PRIMARY KEY,
                uuid VARCHAR(36) UNIQUE NOT NULL,
                pattern_type VARCHAR(50) NOT NULL,
                currency_pair VARCHAR(10) NOT NULL,
                notification_data JSONB NOT NULL,
                sent_at TIMESTAMP WITH TIME ZONE NOT NULL,
                discord_message_id VARCHAR(50),
                status VARCHAR(20) DEFAULT 'sent',
                created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                version INTEGER DEFAULT 1
            );

        - name: "ApiCallHistoryModelä½œæˆ"
          file: "src/infrastructure/database/models/api_call_history_model.py"
          description: "APIå‘¼ã³å‡ºã—å±¥æ­´ç”¨ãƒ¢ãƒ‡ãƒ«"
          sql_schema: |
            CREATE TABLE api_call_history (
                id SERIAL PRIMARY KEY,
                uuid VARCHAR(36) UNIQUE NOT NULL,
                api_name VARCHAR(50) NOT NULL,
                endpoint VARCHAR(100) NOT NULL,
                currency_pair VARCHAR(10),
                response_time_ms INTEGER,
                status_code INTEGER,
                success BOOLEAN NOT NULL,
                error_message TEXT,
                called_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                version INTEGER DEFAULT 1
            );

      domain_entities:
        - name: "AnalysisCacheã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ"
          file: "src/domain/entities/analysis_cache.py"
          description: "åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£"
          base_class: "BaseEntity"
          fields:
            - "analysis_type: str"
            - "currency_pair: str"
            - "timeframe: Optional[str]"
            - "analysis_data: Dict[str, Any]"
            - "cache_key: str"
            - "expires_at: datetime"

        - name: "NotificationHistoryã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ"
          file: "src/domain/entities/notification_history.py"
          description: "é€šçŸ¥å±¥æ­´ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£"
          base_class: "BaseEntity"
          fields:
            - "pattern_type: str"
            - "currency_pair: str"
            - "notification_data: Dict[str, Any]"
            - "sent_at: datetime"
            - "discord_message_id: Optional[str]"
            - "status: str"

        - name: "ApiCallHistoryã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ"
          file: "src/domain/entities/api_call_history.py"
          description: "APIå‘¼ã³å‡ºã—å±¥æ­´ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£"
          base_class: "BaseEntity"
          fields:
            - "api_name: str"
            - "endpoint: str"
            - "currency_pair: Optional[str]"
            - "response_time_ms: Optional[int]"
            - "status_code: Optional[int]"
            - "success: bool"
            - "error_message: Optional[str]"
            - "called_at: datetime"

      repositories:
        - name: "AnalysisCacheRepositoryä½œæˆ"
          file: "src/domain/repositories/analysis_cache_repository.py"
          description: "åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"
          methods:
            - "find_by_cache_key(cache_key: str)"
            - "find_by_analysis_type(analysis_type: str, currency_pair: str)"
            - "save(analysis_cache: AnalysisCache)"
            - "delete_expired()"

        - name: "NotificationHistoryRepositoryä½œæˆ"
          file: "src/domain/repositories/notification_history_repository.py"
          description: "é€šçŸ¥å±¥æ­´ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"
          methods:
            - "find_recent_by_pattern(pattern_type: str, currency_pair: str, hours: int)"
            - "save(notification_history: NotificationHistory)"
            - "find_by_discord_message_id(message_id: str)"

        - name: "ApiCallHistoryRepositoryä½œæˆ"
          file: "src/domain/repositories/api_call_history_repository.py"
          description: "APIå‘¼ã³å‡ºã—å±¥æ­´ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"
          methods:
            - "save(api_call_history: ApiCallHistory)"
            - "find_recent_calls(api_name: str, minutes: int)"
            - "get_call_statistics(api_name: str, hours: int)"

      implementations:
        - name: "AnalysisCacheRepositoryImplä½œæˆ"
          file: "src/infrastructure/database/repositories/analysis_cache_repository_impl.py"
          description: "åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…"
          base_class: "BaseRepositoryImpl"
          dependencies:
            - "AnalysisCacheModel"
            - "AnalysisCache"

        - name: "NotificationHistoryRepositoryImplä½œæˆ"
          file: "src/infrastructure/database/repositories/notification_history_repository_impl.py"
          description: "é€šçŸ¥å±¥æ­´ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…"
          base_class: "BaseRepositoryImpl"
          dependencies:
            - "NotificationHistoryModel"
            - "NotificationHistory"

        - name: "ApiCallHistoryRepositoryImplä½œæˆ"
          file: "src/infrastructure/database/repositories/api_call_history_repository_impl.py"
          description: "APIå‘¼ã³å‡ºã—å±¥æ­´ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…"
          base_class: "BaseRepositoryImpl"
          dependencies:
            - "ApiCallHistoryModel"
            - "ApiCallHistory"

      cache_system:
        - name: "CacheManagerä½œæˆ"
          file: "src/infrastructure/cache/cache_manager.py"
          description: "3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥"
            - "ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥"
            - "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥"
            - "æœ‰åŠ¹æœŸé™ç®¡ç†"
            - "è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"

        - name: "FileCacheä½œæˆ"
          file: "src/infrastructure/cache/file_cache.py"
          description: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "ãƒ‡ã‚£ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥"
            - "ã‚µã‚¤ã‚ºåˆ¶é™"
            - "TTLç®¡ç†"
            - "åœ§ç¸®æ©Ÿèƒ½"

      migrations:
        - name: "Alembicãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ"
          description: "æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"
          commands:
            - "alembic revision --autogenerate -m 'Add cache and history tables'"
            - "alembic upgrade head"

      tests:
        - name: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆ"
          file: "tests/unit/test_cache_models.py"
          description: "æ–°è¦ãƒ¢ãƒ‡ãƒ«ã®å˜ä½“ãƒ†ã‚¹ãƒˆ"

        - name: "ãƒªãƒã‚¸ãƒˆãƒªãƒ†ã‚¹ãƒˆ"
          file: "tests/unit/test_cache_repositories.py"
          description: "æ–°è¦ãƒªãƒã‚¸ãƒˆãƒªã®å˜ä½“ãƒ†ã‚¹ãƒˆ"

        - name: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ"
          file: "tests/unit/test_cache_manager.py"
          description: "CacheManagerã®å˜ä½“ãƒ†ã‚¹ãƒˆ"

  phase_2:
    name: "ãƒ‡ãƒ¼ã‚¿æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ "
    duration: "1é€±é–“"
    priority: "é«˜"
    dependencies: ["phase_1"]

    tasks:
      optimization_system:
        - name: "DataOptimizerä½œæˆ"
          file: "src/infrastructure/optimization/data_optimizer.py"
          description: "ãƒ‡ãƒ¼ã‚¿å–å¾—æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "ä¸€æ‹¬ãƒ‡ãƒ¼ã‚¿å–å¾—"
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆ"
            - "åŠ¹ç‡çš„ãªå±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—"
            - "APIåˆ¶é™å¯¾å¿œ"

        - name: "ApiRateLimiterä½œæˆ"
          file: "src/infrastructure/optimization/api_rate_limiter.py"
          description: "APIåˆ¶é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•"
            - "ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç›£è¦–"
            - "è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤"
            - "åˆ¶é™å›é¿æˆ¦ç•¥"

        - name: "BatchProcessorä½œæˆ"
          file: "src/infrastructure/optimization/batch_processor.py"
          description: "ãƒãƒƒãƒå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "ä¸€æ‹¬APIå‘¼ã³å‡ºã—"
            - "ä¸¦åˆ—å‡¦ç†"
            - "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°"
            - "çµæœé›†ç´„"

      analysis_cache:
        - name: "AnalysisCacheä½œæˆ"
          file: "src/infrastructure/cache/analysis_cache.py"
          description: "åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥"
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–"
            - "æœ‰åŠ¹æœŸé™ç®¡ç†"
            - "çµ±è¨ˆæƒ…å ±"

      client_optimization:
        - name: "YahooFinanceClientæœ€é©åŒ–"
          file: "src/infrastructure/external_apis/yahoo_finance_client.py"
          description: "Yahoo Financeã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæœ€é©åŒ–"
          changes:
            - "DataOptimizerçµ±åˆ"
            - "ApiRateLimiterçµ±åˆ"
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆ"
            - "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„"

        - name: "TechnicalIndicatorsæœ€é©åŒ–"
          file: "src/infrastructure/analysis/technical_indicators.py"
          description: "ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼æœ€é©åŒ–"
          changes:
            - "AnalysisCacheçµ±åˆ"
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯è¿½åŠ "
            - "åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—"

        - name: "CurrencyCorrelationAnalyzeræœ€é©åŒ–"
          file: "src/infrastructure/analysis/currency_correlation_analyzer.py"
          description: "é€šè²¨ç›¸é–¢ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼æœ€é©åŒ–"
          changes:
            - "DataOptimizerçµ±åˆ"
            - "ä¸€æ‹¬å–å¾—æœ€é©åŒ–"
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆ"

      utilities:
        - name: "CacheUtilsä½œæˆ"
          file: "src/utils/cache_utils.py"
          description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£"
          features:
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ"
            - "TTLè¨ˆç®—"
            - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆ"

        - name: "OptimizationUtilsä½œæˆ"
          file: "src/utils/optimization_utils.py"
          description: "æœ€é©åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£"
          features:
            - "ãƒãƒƒãƒå‡¦ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼"
            - "ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨ˆç®—"
            - "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š"

      tests:
        - name: "æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ"
          file: "tests/unit/test_data_optimizer.py"
          description: "DataOptimizerã®å˜ä½“ãƒ†ã‚¹ãƒˆ"

        - name: "åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ"
          file: "tests/unit/test_analysis_cache.py"
          description: "AnalysisCacheã®å˜ä½“ãƒ†ã‚¹ãƒˆ"

        - name: "çµ±åˆãƒ†ã‚¹ãƒˆ"
          file: "tests/integration/test_optimization_flow.py"
          description: "æœ€é©åŒ–ãƒ•ãƒ­ãƒ¼ã®çµ±åˆãƒ†ã‚¹ãƒˆ"

  phase_3:
    name: "é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–"
    duration: "1é€±é–“"
    priority: "ä¸­"
    dependencies: ["phase_1", "phase_2"]

    tasks:
      notification_system:
        - name: "NotificationManageræ‹¡å¼µ"
          file: "src/infrastructure/messaging/notification_manager.py"
          description: "é€šçŸ¥ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µ"
          features:
            - "é‡è¤‡é˜²æ­¢æ©Ÿèƒ½"
            - "é€šçŸ¥å±¥æ­´ç®¡ç†"
            - "ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºçµ±åˆ"
            - "çµ±è¨ˆæƒ…å ±"

        - name: "DiscordClientæ‹¡å¼µ"
          file: "src/infrastructure/messaging/discord_client.py"
          description: "Discordã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ‹¡å¼µ"
          changes:
            - "é€šçŸ¥å±¥æ­´è¨˜éŒ²"
            - "é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½"
            - "çµ±è¨ˆæƒ…å ±è¿½åŠ "

      cron_integration:
        - name: "integrated_ai_discordæœ€é©åŒ–"
          file: "scripts/cron/integrated_ai_discord.py"
          description: "çµ±åˆAI Discordæœ€é©åŒ–"
          changes:
            - "CacheManagerçµ±åˆ"
            - "DataOptimizerçµ±åˆ"
            - "AnalysisCacheçµ±åˆ"
            - "NotificationManagerçµ±åˆ"

        - name: "real_ai_discord_v2æœ€é©åŒ–"
          file: "scripts/cron/real_ai_discord_v2.py"
          description: "ãƒªã‚¢ãƒ«AI Discordæœ€é©åŒ–"
          changes:
            - "CacheManagerçµ±åˆ"
            - "DataOptimizerçµ±åˆ"
            - "AnalysisCacheçµ±åˆ"
            - "NotificationManagerçµ±åˆ"

        - name: "data_scheduleræœ€é©åŒ–"
          file: "scripts/cron/data_scheduler.py"
          description: "ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æœ€é©åŒ–"
          changes:
            - "DataOptimizerçµ±åˆ"
            - "ãƒãƒƒãƒå‡¦ç†æœ€é©åŒ–"
            - "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„"

      monitoring:
        - name: "APIå‘¼ã³å‡ºã—ç›£è¦–"
          description: "APIå‘¼ã³å‡ºã—å›æ•°ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ "
          features:
            - "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–"
            - "ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½"
            - "çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"

        - name: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç›£è¦–"
          description: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã®ç›£è¦–"
          features:
            - "ãƒ’ãƒƒãƒˆç‡æ¸¬å®š"
            - "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–"
            - "è‡ªå‹•æœ€é©åŒ–"

      tests:
        - name: "é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ"
          file: "tests/unit/test_notification_manager.py"
          description: "NotificationManagerã®å˜ä½“ãƒ†ã‚¹ãƒˆ"

        - name: "Cronçµ±åˆãƒ†ã‚¹ãƒˆ"
          file: "tests/integration/test_cron_integration.py"
          description: "Cronã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ"

        - name: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"
          file: "tests/performance/test_api_optimization.py"
          description: "APIæœ€é©åŒ–ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"

# ğŸ“Š ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—
dependencies:
  import_mapping:
    cache_manager:
      imports:
        - "from src.infrastructure.database.connection import get_async_session"
        - "from src.infrastructure.cache.file_cache import FileCache"
        - "from src.utils.cache_utils import generate_cache_key"
      used_by:
        - "data_optimizer"
        - "analysis_cache"
        - "notification_manager"

    data_optimizer:
      imports:
        - "from src.infrastructure.cache.cache_manager import CacheManager"
        - "from src.infrastructure.external_apis.yahoo_finance_client import YahooFinanceClient"
        - "from src.infrastructure.optimization.api_rate_limiter import ApiRateLimiter"
      used_by:
        - "integrated_ai_discord"
        - "real_ai_discord_v2"
        - "data_scheduler"

    analysis_cache:
      imports:
        - "from src.infrastructure.database.repositories.analysis_cache_repository_impl import AnalysisCacheRepositoryImpl"
        - "from src.domain.entities.analysis_cache import AnalysisCache"
      used_by:
        - "technical_indicators"
        - "currency_correlation_analyzer"
        - "integrated_ai_discord"

    notification_manager:
      imports:
        - "from src.infrastructure.messaging.discord_client import DiscordClient"
        - "from src.infrastructure.database.repositories.notification_history_repository_impl import NotificationHistoryRepositoryImpl"
      used_by:
        - "integrated_ai_discord"
        - "real_ai_discord_v2"

# ğŸ”§ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
configuration:
  cache_settings:
    file: "config/cache_settings.py"
    content: |
      CACHE_CONFIG = {
          "memory_cache": {
              "max_size": 1000,
              "ttl_seconds": 300
          },
          "file_cache": {
              "path": "/app/cache",
              "max_size_mb": 100,
              "ttl_seconds": 1800
          },
          "database_cache": {
              "ttl_minutes": 60,
              "cleanup_interval_hours": 24
          }
      }

  optimization_settings:
    file: "config/optimization_settings.py"
    content: |
      OPTIMIZATION_CONFIG = {
          "api_rate_limits": {
              "yahoo_finance": {
                  "calls_per_minute": 100,
                  "calls_per_hour": 1000,
                  "backoff_multiplier": 2.0
              }
          },
          "batch_processing": {
              "max_concurrent_requests": 5,
              "request_delay_ms": 100
          }
      }

# ğŸ“ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
implementation_checklist:
  phase_1:
    database:
      - "AnalysisCacheModelä½œæˆ"
      - "NotificationHistoryModelä½œæˆ"
      - "ApiCallHistoryModelä½œæˆ"
      - "Alembicãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ"
    domain:
      - "AnalysisCacheã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ"
      - "NotificationHistoryã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ"
      - "ApiCallHistoryã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ"
    repositories:
      - "AnalysisCacheRepositoryä½œæˆ"
      - "NotificationHistoryRepositoryä½œæˆ"
      - "ApiCallHistoryRepositoryä½œæˆ"
      - "å„ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ä½œæˆ"
    cache:
      - "CacheManagerä½œæˆ"
      - "FileCacheä½œæˆ"
    tests:
      - "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆ"
      - "ãƒªãƒã‚¸ãƒˆãƒªãƒ†ã‚¹ãƒˆ"
      - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ"

  phase_2:
    optimization:
      - "DataOptimizerä½œæˆ"
      - "ApiRateLimiterä½œæˆ"
      - "BatchProcessorä½œæˆ"
    analysis_cache:
      - "AnalysisCacheä½œæˆ"
    client_optimization:
      - "YahooFinanceClientæœ€é©åŒ–"
      - "TechnicalIndicatorsæœ€é©åŒ–"
      - "CurrencyCorrelationAnalyzeræœ€é©åŒ–"
    utilities:
      - "CacheUtilsä½œæˆ"
      - "OptimizationUtilsä½œæˆ"
    tests:
      - "æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ"
      - "åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ"
      - "çµ±åˆãƒ†ã‚¹ãƒˆ"

  phase_3:
    notification:
      - "NotificationManageræ‹¡å¼µ"
      - "DiscordClientæ‹¡å¼µ"
    cron_integration:
      - "integrated_ai_discordæœ€é©åŒ–"
      - "real_ai_discord_v2æœ€é©åŒ–"
      - "data_scheduleræœ€é©åŒ–"
    monitoring:
      - "APIå‘¼ã³å‡ºã—ç›£è¦–"
      - "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç›£è¦–"
    tests:
      - "é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ"
      - "Cronçµ±åˆãƒ†ã‚¹ãƒˆ"
      - "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"

# ğŸ¯ æœŸå¾…åŠ¹æœ
expected_results:
  api_calls:
    before: 171
    after: 30
    reduction_percentage: 82.5
    breakdown:
      database_cache: "60%å‰Šæ¸›"
      analysis_cache: "20%å‰Šæ¸›"
      batch_optimization: "10%å‰Šæ¸›"

  performance:
    response_time:
      before: "3-5ç§’"
      after: "1-2ç§’"
      improvement: "50%çŸ­ç¸®"
    error_rate:
      before: "15%"
      after: "1.5%"
      improvement: "90%å‰Šæ¸›"
    system_stability:
      before: "ä¸å®‰å®š"
      after: "å®‰å®š"
      improvement: "å¤§å¹…å‘ä¸Š"

# ğŸ” ãƒªã‚¹ã‚¯ç®¡ç†
risk_management:
  technical_risks:
    - risk: "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¸æ•´åˆ"
      mitigation: "å®šæœŸçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"
    - risk: "ãƒ¡ãƒ¢ãƒªä¸è¶³"
      mitigation: "ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–"
    - risk: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è² è·"
      mitigation: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–"

  operational_risks:
    - risk: "æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ"
      mitigation: "æ®µéšçš„ãªãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ"
    - risk: "ãƒ‡ãƒ¼ã‚¿å“è³ªä½ä¸‹"
      mitigation: "ãƒ‡ãƒ¼ã‚¿é®®åº¦ç›£è¦–"

# ğŸ“š å‚è€ƒè³‡æ–™
references:
  - "api_optimization_design_2025.md"
  - "notification_implementation_plan_2025.yaml"
  - "ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­è¨ˆ_20250809.md"
  - "è©³ç´°å†…éƒ¨è¨­è¨ˆ_20250809.md"
